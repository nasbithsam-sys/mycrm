{% extends "base.html" %}
{% block title %}Processor Dashboard - AccBoost CRM{% endblock %}
{% block content %}

<!-- Page Header -->
<div class="page-header mb-4">
  <div class="row align-items-center">
    <div class="col">
      <h1 class="page-title fw-bold">
        âš¡ Processor Dashboard
      </h1>
      <div class="text-muted mt-1">
        Focus Mode: Review & Handle <strong>New Leads Only</strong>
      </div>
    </div>
    <div class="col-auto">
      <span class="badge bg-primary fs-6 py-2 px-3">
        {{ leads|length }} New Lead{{ 's' if leads|length != 1 }}
      </span>
    </div>
  </div>
</div>

<!-- Quick Stats -->
<div class="row g-3 mb-4">
  <div class="col-sm-6 col-lg-3">
    <div class="card card-sm bg-primary-lt">
      <div class="card-body d-flex align-items-center">
        <div class="me-3 text-primary">
          <i class="ti ti-file-text fs-2"></i>
        </div>
        <div>
          <div class="text-muted small">Total New Leads</div>
          <div class="fw-bold fs-4">{{ total_new or leads|length }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card card-sm bg-success-lt">
      <div class="card-body d-flex align-items-center">
        <div class="me-3 text-success">
          <i class="ti ti-user-check fs-2"></i>
        </div>
        <div>
          <div class="text-muted small">My Processed Leads</div>
          <div class="fw-bold fs-4">{{ my_leads or 0 }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card card-sm bg-warning-lt">
      <div class="card-body d-flex align-items-center">
        <div class="me-3 text-warning">
          <i class="ti ti-calendar-event fs-2"></i>
        </div>
        <div>
          <div class="text-muted small">New Leads Today</div>
          <div class="fw-bold fs-4">{{ new_today or 0 }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Search Bar -->
<div class="card mb-3">
  <div class="card-body py-2">
    <div class="input-icon">
      <input type="text" id="searchInput" class="form-control" placeholder="ðŸ” Search by customer, number, or department..." onkeyup="filterTable()">
      <span class="input-icon-addon">
        <i class="ti ti-search"></i>
      </span>
    </div>
  </div>
</div>

<!-- Leads Table -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">ðŸ“‹ New Leads Assigned</h3>
  </div>
  <div class="card-body p-0">
    {% if leads %}
    <div class="table-responsive">
      <table id="leadsTable" class="table table-vcenter table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th>Customer</th>
            <th>Number</th>
            <th>Department</th>
            <th>Context</th>
            <th>Created At</th>
          </tr>
        </thead>
        <tbody>
          {% for lead in leads %}
          <tr>
            <td class="fw-semibold">{{ lead.customer_name }}</td>
            <td>{{ lead.customer_number }}</td>
            <td><span class="badge bg-info-lt text-dark">{{ lead.department }}</span></td>
            <td class="text-muted">{{ lead.context_service }}</td>
            <td>{{ lead.created_at.strftime("%d %b %Y, %I:%M %p") }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="p-5 text-center text-muted">
      <i class="ti ti-coffee fs-2 d-block mb-2"></i>
      <strong>No new leads right now â˜•</strong><br>
      Take a short break â€” youâ€™ve processed everything like a pro!
    </div>
    {% endif %}
  </div>
</div>

<!-- Search Script -->
<script>
function filterTable() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  const rows = document.querySelectorAll("#leadsTable tbody tr");

  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(input) ? "" : "none";
  });
}
</script>

{% endblock %}
